<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Oqqo'rg'on uchun xizmat so'rovnomasi</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 10px;
    }
    .question {
      margin-bottom: 25px;
    }
    .options button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border: none;
      border-radius: 6px;
      background-color: #eee;
      cursor: pointer;
      transition: background 0.3s;
    }
    .options button:hover {
      background-color: #d6eaff;
    }
    .result {
      margin-top: 10px;
    }
    .bar {
      height: 16px;
      background-color: #4caf50;
      border-radius: 4px;
      transition: width 0.4s ease-in-out;
    }
    .option-result {
      margin-top: 5px;
    }
    .views {
      font-size: 0.9em;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Oqqo'rg'on uchun xizmat ko'rsatish</h2>

    <div class="question" data-id="q1">
      <p>1. Siz bitta ilovada hamma xizmatlarni ishlatishni xohlaysizmi?</p>
      <div class="views" id="views-q1">üëÅ 0 kishi ko'rdi</div>
      <div class="options">
        <button onclick="vote('q1', 'Ha')">Ha</button>
        <button onclick="vote('q1', 'Yoq')">Yo‚Äòq</button>
      </div>
      <div class="result" id="result-q1"></div>
    </div>

    <div class="question" data-id="q2">
      <p>2. Taksi, ovqat, ishchi chaqirish, to‚Äòlov ‚Äì hammasi bitta joyda bo‚Äòlishi sizga qulaymi?</p>
      <div class="views" id="views-q2">üëÅ 0 kishi ko'rdi</div>
      <div class="options">
        <button onclick="vote('q2', 'Ha albatta')">Ha albatta</button>
        <button onclick="vote('q2', 'Kerakli ekan')">Kerakli ekan</button>
        <button onclick="vote('q2', 'Yo‚Äòq kerak emas')">Yo‚Äòq kerak emas</button>
      </div>
      <div class="result" id="result-q2"></div>
    </div>

    <div class="question" data-id="q3">
      <p>3. Bitta akkaunt orqali hamma xizmatlardan foydalanish, tarixni ko‚Äòrish, real holatni kuzatish imkoniyati bo‚Äòlsa nima deysiz?</p>
      <div class="views" id="views-q3">üëÅ 0 kishi ko'rdi</div>
      <div class="options">
        <button onclick="vote('q3', 'Yaxshi bo‚Äòlar edi')">Yaxshi bo‚Äòlar edi</button>
        <button onclick="vote('q3', 'Menga kerak emas')">Menga kerak emas</button>
      </div>
      <div class="result" id="result-q3"></div>
    </div>
  </div>

  <script>
    const pollData = JSON.parse(localStorage.getItem('pollData') || '{}');
    const viewCounts = JSON.parse(localStorage.getItem('viewCounts') || '{}');
    const votes = JSON.parse(localStorage.getItem('votes') || '{}');

    const questions = {
      q1: ['Ha', 'Yoq'],
      q2: ['Ha albatta', 'Kerakli ekan', 'Yo‚Äòq kerak emas'],
      q3: ['Yaxshi bo‚Äòlar edi', 'Menga kerak emas']
    };

    Object.keys(questions).forEach(id => {
      if (!pollData[id]) {
        pollData[id] = {};
        questions[id].forEach(opt => pollData[id][opt] = 0);
      }
      if (!votes[id]) {
        votes[id] = null;
      }

      viewCounts[id] = (viewCounts[id] || 0) + 1;
      document.getElementById(`views-${id}`).innerText = `üëÅ ${viewCounts[id]} kishi ko'rdi`;
      renderResults(id);
    });

    function vote(questionId, option) {
      const prevVote = votes[questionId];
      if (prevVote && prevVote !== option) pollData[questionId][prevVote]--;
      pollData[questionId][option]++;
      votes[questionId] = option;

      localStorage.setItem('pollData', JSON.stringify(pollData));
      localStorage.setItem('votes', JSON.stringify(votes));
      renderResults(questionId);
    }

    function renderResults(questionId) {
      const resultBox = document.getElementById(`result-${questionId}`);
      const data = pollData[questionId];
      const total = Object.values(data).reduce((a, b) => a + b, 0) || 1;

      resultBox.innerHTML = '';

      for (let [key, count] of Object.entries(data)) {
        const percent = Math.round((count / total) * 100);
        resultBox.innerHTML += `
          <div class="option-result">
            ${key}: ${count} ta (${percent}%)
            <div class="bar" style="width: ${percent}%"></div>
          </div>
        `;
      }
    }

    localStorage.setItem('pollData', JSON.stringify(pollData));
    localStorage.setItem('viewCounts', JSON.stringify(viewCounts));
    localStorage.setItem('votes', JSON.stringify(votes));
  </script>
</body>
</html>
